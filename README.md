# Random Chats

Добро пожаловать в проект Random Chats — приложение для анонимного общения с новыми людьми на основе общих интересов и предпочтений.

## Оглавление

1. [Описание проекта](#описание-проекта)
2. [Архитектура](#архитектура)
  - [Общая архитектура](#общая-архитектура)
  - [Микросервисы](#микросервисы)
3. [Запуск проекта](#запуск-проекта)
  - [Предварительные требования](#предварительные-требования)
  - [Инструкция по запуску](#инструкция-по-запуску)
4. [Дополнительная информация](#дополнительная-информация)
5. [Авторы](#авторы)

## Описание проекта

Random Chats — это приложение, которое позволяет пользователям общаться с незнакомыми людьми, подбирая собеседников на основе общих интересов и предпочтений. В отличие от обычных чат-рулеток, здесь собеседники подбираются не случайно, а с учетом ваших предпочтений.

На первом этапе учитываются пол и возраст, в будущем планируется расширить функциональность подбора на основе более глубоких интересов.

## Архитектура

![Архитектура - 'Найди друга'-3](https://github.com/user-attachments/assets/44b267e4-2a1f-4c18-ac4e-3c7fb1ca7313)

### Общая архитектура

Архитектура приложения построена на микросервисной структуре с использованием API Gateway и балансировщика нагрузки (Load Balancer, LB) для управления сервисами и распределения запросов. Все сервисы взаимодействуют через HTTP или WebSocket, обеспечивая высокую скорость передачи данных.

- **Redis**: Используется как центральное хранилище для кэширования данных о подключениях пользователей к WebSocket Handlers и менеджерам. Также поддерживает быструю синхронизацию между обработчиками.
- **WebSocket Manager**: Управляет сессиями пользователей и взаимодействует с Redis для хранения данных о подключениях.
- **WebSocket Handlers**: Принимают и отправляют сообщения пользователей, взаимодействуя с WebSocket Manager, Redis и Message Service.
- **Message Service**: Отвечает за обработку сообщений и их сохранение в базе данных MongoDB, а также управление статусами доставки.
- **PostgreSQL и DynamoDB**: PostgreSQL хранит данные о пользователях, а DynamoDB используется для управления сессиями и токенами доступа.
- **API Gateway**: Является единой точкой входа для всех клиентских запросов, маршрутизируя их к соответствующим сервисам.

Взаимодействие между сервисами:
1. WebSocket Handlers обращаются к WebSocket Manager и Redis для синхронизации данных о подключениях.
2. Message Service обрабатывает сообщения и взаимодействует с MongoDB для их хранения.
3. Auth Service взаимодействует с PostgreSQL для управления учетными записями пользователей и токенами аутентификации.
4. Matching Service работает с Redis для управления очередями пользователей и API Gateway для регистрации новых соединений.

### Микросервисы

#### 1. Auth Service

Асинхронный сервер, разработанный с использованием FastAPI, обеспечивает функции регистрации, авторизации и аутентификации пользователей. Работает с реляционной базой данных PostgreSQL.

- **Функциональность**:
  - Регистрация новых пользователей с сохранением их данных в базу данных PostgreSQL.
  - Авторизация пользователей с выдачей JWT токенов доступа и обновления.
  - Аутентификация пользователей по токену при последующих запросах.

- **Взаимодействие с другими сервисами**:
  - Matching Service: предоставляет информацию о пользователях для подбора собеседников.

#### 2. Matching Service

Matching Service реализует логику подбора пользователей для общения на основе их предпочтений.

- **Функциональность**:
  - Поддерживает очереди пользователей в зависимости от их характеристик (возраст, пол и предпочтения).
  - Ищет подходящего собеседника для пользователя из очереди.
  - При успешном подборе инициирует создание нового чата между пользователями.

- **Технологии**:
  - FastAPI: для построения асинхронного сервера.
  - Redis: используется как база данных «ключ-значение» для хранения очередей пользователей.

- **Взаимодействие с другими сервисами**:
  - Auth Service: запрашивает информацию о пользователях для определения их характеристик и предпочтений.
  - Message Service: проверяет возможность создания нового чата между пользователями.

#### 3. WebSocket Manager

WebSocket Manager управляет информацией о том, какие пользователи подключены к каким обработчикам WebSocket.

- **Функциональность**:
  - Регистрирует подключения пользователей к определенным WebSocket Handler.
  - Хранит информацию о текущих активных соединениях в Redis.
  - Предоставляет WebSocket Handlers данные о том, какой пользователь к какому обработчику подключен.

- **Взаимодействие с другими сервисами**:
  - WebSocket Handlers: получают и отправляют информацию о подключениях пользователей.
  - Redis: используется для хранения данных о подключениях.

#### 4. WebSocket Handler

WebSocket Handler обеспечивает обмен сообщениями в реальном времени между пользователями через WebSocket соединения.

- **Функциональность**:
  - Обрабатывает WebSocket соединения от клиентов.
  - Принимает и отправляет сообщения между пользователями.
  - Сохраняет сообщения в Message Service.
  - Отслеживает статус доставки и прочтения сообщений.

- **Взаимодействие с другими сервисами**:
  - WebSocket Manager: для регистрации и получения информации о подключениях пользователей.
  - Message Service: для сохранения и получения сообщений.
  - Redis: для синхронизации подключений.

#### 5. Message Service

Message Service отвечает за хранение и управление сообщениями и чатами между пользователями.

- **Функциональность**:
  - Хранит информацию о чатах и сообщениях между пользователями.
  - Обеспечивает интерфейсы для создания чатов и сообщений.
  - Обновляет статусы доставленных и прочитанных сообщений.

- **Взаимодействие с другими сервисами**:
  - WebSocket Handlers: получают и отправляют сообщения через этот сервис.
  - Matching Service: проверяет возможность создания нового чата между пользователями.

#### 6. API Gateway

API Gateway служит единой точкой входа для всех клиентских запросов и обеспечивает маршрутизацию к соответствующим микросервисам.

- **Функциональность**:
  - Маршрутизирует входящие HTTP и WebSocket запросы к нужным сервисам.
  - Выполняет балансировку нагрузки между экземплярами сервисов.
  - Обрабатывает аутентификацию и валидацию токенов через Auth Service.

- **Взаимодействие с другими сервисами**:
  - Является посредником между клиентами и всеми микросервисами системы, обеспечивая корректную маршрутизацию и безопасность.

## Запуск проекта

### Предварительные требования

- Python 3.8+
- MongoDB
- PostgreSQL
- Redis
- Установленные зависимости (из файлов requirements.txt)

### Инструкция по запуску

1. Клонируйте репозиторий:
```shell
git clone https://github.com/RomanMuteki/random-chats.git
cd random-chats
```

2. Настройте конфигурационные файлы:

В каждой папке микросервиса есть файл config.json. Заполните его, указав необходимые параметры подключения к базам данных и прочие настройки.

3. Установите зависимости для каждого микросервиса:

Поскольку каждый микросервис является отдельным приложением со своими зависимостями, рекомендуется создать отдельное виртуальное окружение для каждого микросервиса и установить необходимые пакеты через `pip install -r requirements.txt`.

4. Запустите микросервисы:

Для каждого микросервиса выполните:
```shell
uvicorn main:app --host 0.0.0.0 --port PORT_NUMBER
```
или
```shell
python3 main.py
```
(в зависимости от микросервиса)

5. Запустите клиентское приложение:

  Клиентская часть написана на C++ с использованием Qt и предназначена для работы под Windows. Откройте проект в Qt Creator и запустите приложение.

6. Мониторинг и отладка:

  Для отладки микросервисов можно обращаться к логам, доступным по адресу http://url_микросервиса/logs. (позже необходимо отключить вывод логов в публичный доступ для обеспечения безопасности

## Авторы

- Зайнуллин М. — Архитектура проекта, API Gateway, Message Service, WebSocket Handler, WebSocket Manager.
- Аникин Р. — Auth Service, Matching Service
- Горынцев Р. — Интерфейс приложения.

